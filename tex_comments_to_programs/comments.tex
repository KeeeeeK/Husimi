\documentclass[a4paper, 12pt]{article}

%Русский язык
\renewcommand{\familydefault}{\sfdefault}%шрифт
\usepackage[T2A]{fontenc} %кодировка
\usepackage[utf8]{inputenc} %кодировка исходного кода
\usepackage[english,russian]{babel} %локализация и переносы
%отступы 
\usepackage[left=2cm,right=2cm,top=2cm,bottom=3cm,bindingoffset=0cm]{geometry}
\usepackage{indentfirst}
%Вставка картинок
\usepackage{graphicx}
\graphicspath{}
\DeclareGraphicsExtensions{.pdf,.png,.jpg, .jpeg}

%Таблицы
\usepackage[table,xcdraw]{xcolor}
\usepackage{booktabs}


%Математика
\usepackage{physics}
\usepackage{amssymb}
% \DeclareMathOperator*{\Res}{Res}
\DeclareMathOperator*{\sign}{sign}
\DeclareMathOperator*{\Real}{Re}
\DeclareMathOperator*{\Imag}{Im}

%%Окружение для многострочных уравнений
\newenvironment{eqw}{\begin{equation} \begin{aligned}}   
    {\end{aligned}    \end{equation}}
\newenvironment{eqw*}{\begin{equation*} \begin{aligned}}   
    {\end{aligned}    \end{equation*}}
%Заголовок
\title{Заметки по работе проги}
\author{Нугманов Булат}

\begin{document}
\maketitle
\section{Про тупое суммирование Хусими}
\subsection*{Приближение для ряда}
Обозначение:
\begin{equation}
\begin{aligned}
    \alpha = r e^{i\phi}
\end{aligned}
\end{equation}

Стирлинг:
\begin{equation}
\begin{aligned}
    n! \approx \sqrt{2\pi n} \left(\frac{n}{e}\right)^n e^{\frac{1}{12n}+\dots}
\end{aligned}
\end{equation}

Логарифм одного слагаемого в $F-normalized$:
\begin{equation}
\begin{aligned}
    &\ln\left(\frac{\alpha^n e^{i\phi n + i\gamma n(n+1)}}{n!}e^{-r}\right)  \approx 
    \ln\left(\frac{r^n e^{i\phi n + i\gamma n(n+1)}}{\sqrt{2\pi n} \left(\frac{n}{e}\right)^n e^{\frac{1}{12n}}}e^{-r}\right) =\\
    &=n \left(\ln r + i \phi + i \gamma (n+1)\right) - \frac{1}{2}\ln\left(2\pi\right) 
    - \frac{1}{2}\ln n - n \left(\ln n - 1\right) - \frac{1}{12n} - r\\
    &=n-r + n\cdot\ln\left(\frac{r}{n}\right) + i n \left(\phi + \gamma(n+1)\right)
     -  \frac{1}{12n} - \frac{1}{2}\ln n - \frac{1}{2}\ln\left(2\pi\right) 
\end{aligned}
\end{equation}

\subsection*{Из в $F$ в Хусими}
Это формула 3.3 из моего диплома:
\begin{equation}\label{QsimF}
	Q(\beta) =
	\frac{e^{-|\alpha|^2 -|\beta|^2}}{\pi} \left|F(\alpha \beta^* e^{2 i \Gamma}, e^{-i \Gamma} )\right|^2
\end{equation}

Если использовать $Fn$ --- $F\; normalized$, которое $Fn(r, \phi, \gamma) = F(r e^{i\phi}, e^{i\gamma}) \cdot e^{-r}$, то формула предстанет в следующем виде:

\begin{equation}
\begin{aligned}
    Q(\beta) = \frac{e^{-\left(|\alpha|-|\beta|\right)^2}}{\pi}\left|Fn(|\alpha\beta|, 2 \Gamma + \arg\left(\alpha\beta^*\right), -\Gamma)\right|^2
\end{aligned}
\end{equation}

\subsection*{Вычисление функции Вигнера}
Возьмём некоторый алгоритм расчёта функции $F$, указанной в дипломе. Это может быть как прямое суммирование, так и нахождение через $\max \Real f(z_k)$ или же ассимптотическое разложение при $|Z|\gg 1$. Для вычисления функции Вигнера лучше использовать формулу из диплома под номером (3.25):

\begin{equation}\label{FtoWrow}
	\begin{aligned}
		W(\beta) = \frac{2}{\pi}e^{-|\alpha|^2-2|\beta|^2}\sum\limits_{m=0}^{\infty} \frac{\left(-|\alpha|^2\right)^m}{m!}\left|F(2\alpha \beta^*\psi^{2m-2}, \psi)\right|^2
	\end{aligned}
\end{equation}

Перепишем эту формулу через $Fn(|A|, \arg A, e^{i\Gamma}) = e^{-|A|}F(A, e^{i\Gamma})$:
\begin{equation}
	\begin{aligned}
		W(\beta) = \frac{2}{\pi}e^{-2|\beta|^2 -|\alpha|^2 - 4|\alpha\beta|}\sum\limits_{m=0}^{\infty} \frac{\left(-|\alpha|^2\right)^m}{m!}\left|Fn(2\alpha \beta^*\psi^{2m-2}, \psi)\right|^2
	\end{aligned}
\end{equation}

В последнем ряду основной вклад вносят только члены c $n\sim|\alpha|^2 \pm 3|\alpha|$.
\footnote{Данную оценку можно сузить ещё сильнее, если учесть, что $Q(\dots)$ имеет гауссов колокол. Ширина этого колокола $\sqrt{|\alpha\beta|}2\Gamma$. Так как теоретически это значение порядка может быть велико и зависеть  от $\beta$, мы лучше в тупую просто просуммируем при всех соответсвующих $n$.}

Для дальнейшего разложения пригодится аналогичное уже упоминавшемуся разложение в Стирлинга:
\begin{equation}
    \ln\left(\frac{|\alpha|^{2m}}{m!}\right)\approx 2m \ln|\alpha| - \frac{1}{2}\ln m - m \left(\ln m - 1\right) - \frac{1}{12m}
\end{equation}

\section{Про суммирование Вигнера}
\subsection*{Про связь различных определений $F$}
Возьмём формулу выше, которая следует из моего диплома при использовании старого определения $F$:
\begin{equation}\label{QtoW}
	\begin{aligned}
		W(\beta) = \frac{2}{\pi}e^{\abs{\alpha}^2-2\left(\abs{\beta} - \abs{\alpha}\right)^2}\sum\limits_{m=0}^{\infty} \frac{\left(-|\alpha|^2\right)^m}{m!}\left|Fn(2\alpha \beta^*\psi^{2m-2}, \psi)\right|^2
	\end{aligned}
\end{equation}

Нормализация старого и нового определений совпадает, но сами они чуток отличаюся:
\begin{eqw}
     F_{\text{старое}}(A, \psi = e^{i\Gamma}) &= \sum\limits_{n=0}^{\infty} \frac{A^n}{n!}e^{i\Gamma n(n+1)}\\
     F_{\text{новое}}(A, e^{i\Gamma}) &= \sum\limits_{n=0}^{\infty} \frac{A^n}{n!}e^{i\Gamma n^2}\\
     F_{\text{старое}}(A, e^{i\Gamma}) &= F_{\text{новое}}(Ae^{i\Gamma}, e^{i\Gamma})
\end{eqw}

Такое определение соответствует исходно поставленной задаче с заменой $\Gamma$ на $-\Gamma$. Это не очень существенно для вычислений, но об этом нельзя забывать при выписывании конечного ответа.

Следующая формула использует новое определение $F$:
\begin{eqw}
    W(\beta) = \frac{2}{\pi}e^{\abs{\alpha}^2-2\left(\abs{\beta} - \abs{\alpha}\right)^2}\sum\limits_{m=0}^{\infty} \frac{\left(-|\alpha|^2\right)^m}{m!}\left|Fn(2\alpha \beta^*e^{i\Gamma(2m-1)}, e^{i\Gamma})\right|^2
\end{eqw}

Основной идеей суммирования последнего выражения является преобразование Фурье над $\abs{Fn}$:
\begin{eqw}
    \abs{Fn(Re^{i\Phi}, e^{i\Gamma})}^2 = \sum\limits_k A_k(R)e^{ik\Phi}\\
    Re^{i\Phi} = -2i\times 2\alpha \beta^*e^{i\Gamma(2m-1)}\times \Gamma = Re^{i\Phi_0+2im\Gamma}
\end{eqw}
Суммирование ведётся по частотам $k$, которые пробегают значения из $\mathbb{Z}$.

\begin{eqw}
    W(\beta) &= \frac{2}{\pi}e^{\abs{\alpha}^2-2\left(\abs{\beta} - \abs{\alpha}\right)^2}
    \sum\limits_k A_k(4\abs{\alpha\beta^*\Gamma})
    \sum\limits_{m=0}^{\infty} \frac{\left(-|\alpha|^2\right)^m}{m!}e^{ik\times\left(\Phi_0+2im\Gamma\right)}\\
    &= \frac{2}{\pi}e^{\abs{\alpha}^2-2\left(\abs{\beta} - \abs{\alpha}\right)^2}
    \sum\limits_k A_k(4\abs{\alpha\beta^*\Gamma})e^{ik\Phi_0}
    \exp\left(-\abs{\alpha}^2 e^{2ik\Gamma}\right)\\
    &= \frac{2}{\pi}e^{-2\left(\abs{\beta} - \abs{\alpha}\right)^2}
    \sum\limits_k A_k(4\abs{\alpha\beta^*\Gamma})e^{ik\Phi_0}
    \exp\left(\abs{\alpha}^2 (1-e^{2ik\Gamma})\right)
\end{eqw}

\subsection*{Приблизительный путь... (заброшен)}
\textit{Данный путь основывается на разложении $W$ в ряд Фурье по $\Phi$. Это же самое рассуждение можно применить без приближений, что реализует следующий метод. Если придётся возрождать данный метод, то я бы делал не совсем так, как показано далее. $Re\left(\frac{i}{2}(1+W_k(Re^{i\Phi}))^2\right)$ можно аналитически продолжить по $\Phi$ до $-i\left(\left(1+W_k(Re^{i\Phi})\right)^2 - \left(1+W_k(Re^{-i\Phi})\right)^2\right)$. Это выражение позволяет применить комплексный метод перевала, найдя точку в которой при $k\Gamma\sim 1$ наблюдается перевал. Наивные рассуждения с разложением по малости $\Gamma$ без учёта $k\Gamma\sim 1$ являются ошибочными. Тем не менее я не буду их пока удалять, потому что схожие выкладки могут возникнуть вновь.}

Далее это выражение можно упрощать, раскладывать последнюю экспоненту по малости $\Gamma$ или в ряд Фурье, но так или иначе, сначала надо посчитать коэффициенты $A_k$. Важно также отметить, что количество членов ряда Фурье надо брать достаточно высоким, чтоб было хорошее разложение в Фурье в окрестности пика $Fn$. 

\begin{eqw}
     A_k(R) &= \frac{1}{2\pi}\int\limits_{-\pi}^\pi e^{-ik\Phi} \abs{Fn(Re^{i\Phi}, e^{i\Gamma})}^2 d\Phi \\
    &\approx \frac{e^{-\frac{R}{\abs{\Gamma}}}}{2\pi}\int\limits_{-\pi}^\pi e^{-ik\Phi} 
    \frac{\exp\left(\frac{\Real f(z_k)}{\Gamma}\right)}{\abs{i+z_k}}d\Phi 
\end{eqw}
Введём следующее обозначение:
\begin{eqw}
    b_m = \frac{i^m q_m(-iR\sign\Gamma)}{\left(1-iR\sign \Gamma\right)^{2m-1}}
\end{eqw}
Приведём парочку разложений для подынтгральных функций:
\begin{eqw}
    \Real f(z_k) = R\sign\Gamma - \Real b_1 \frac{\left(\Phi - \Phi_{\max}\right)^2}{2} - \Real b_2 \frac{\left(\Phi - \Phi_{\max}\right)^3}{6} - \Real b_3 \frac{\left(\Phi - \Phi_{\max}\right)^4}{24}+o\left(\left(\Phi - \Phi_{\max}\right)^4\right)
\end{eqw}

\begin{eqw}
     1+W_k(Re^{i\Phi}) &\approx 1+W_k(Re^{i\Phi_{\max}}) + 
     \frac{iW_k(Re^{i\Phi_{\max}})}{1+W_k(Re^{i\Phi_{\max}})}\left(\Phi - \Phi_{\max}\right) - \dots\\
     &\dots-\frac{W_k(Re^{i\Phi_{\max}}) - 2W_k(Re^{i\Phi_{\max}})^2}{\left(1+W_k(Re^{i\Phi_{\max}})\right)^3}\frac{\left(\Phi - \Phi_{\max}\right)^2}{2}\\
     &\approx 1- i R \sign \Gamma + \underbrace{\frac{R \sign \Gamma}{1-i R \sign \Gamma}}_{b_1}\left(\Phi - \Phi_{\max}\right) +
     \underbrace{\frac{i R \sign \Gamma - 2 R^2}{\left(1-i R \sign \Gamma\right)^3}}_{b_2}\frac{\left(\Phi - \Phi_{\max}\right)^2}{2}
\end{eqw}

\begin{eqw}
    \Real f(z_k) \approx R\sign\Gamma - \Real b_1 \frac{\left(\Phi - \Phi_{\max}\right)^2}{2} - \Real b_2 \frac{\left(\Phi - \Phi_{\max}\right)^3}{6} - \Real b_3 \frac{\left(\Phi - \Phi_{\max}\right)^4}{24}+o\left(\left(\Phi - \Phi_{\max}\right)^4\right)
\end{eqw}

Наконец, произведём оценку того, какой точности мы сможем добиться при указанных разложениях ($\phi = \Phi - \Phi_{\max}, x=\sqrt{\frac{{\Re b_1}}{{\Gamma}}}\phi = \sqrt{\frac{R}{\Gamma\left(1+R^2\right)}}\phi$):
\begin{eqw}
     A_k &= \frac{e^{-ik\Phi_{\max}-\frac{R}{\abs{\Gamma}}}}{2\pi}\int\limits_{-\pi}^\pi e^{-ik\phi} 
     \frac{\exp\left(\frac{\Real f(z_k)}{\Gamma}\right)}{\abs{i+z_k}}d\phi \\
    &=\frac{\exp\left(-ik\Phi_{\max}\right)}{2\pi}\int\limits_{-\pi}^\pi
    \exp\left(-\frac{\Real b_1}{\Gamma}\phi^2 -ik\phi \right)d\phi\times\dots\\
    &\dots\times\exp\left(-\frac{\Real b_2}{6\Gamma}\phi^3 - \frac{\Real b_3}{24\Gamma}\phi^4 + O(\phi^5)\right)(p_0 + p_1\phi + p_2\phi^2 + O(\phi^3)) \\
    &= \frac{\exp\left(-ik\Phi_{\max}\right)}{2\pi}\int\limits_{-\infty}^{\infty}\
    \exp\left(-x^2 - ik\sqrt{\frac{\Gamma}{\Real b_1}}x\right) \sqrt{\frac{\Gamma}{\Real b_1}} dx\times\dots\\
    &\dots\times \exp\left(-\frac{\Real b_2}{6\left(\Real b_1\right)^{3/2}}\sqrt{\Gamma}x^3 - \frac{\Real b_3}{24\left(\Real b_1\right)^{2}}\Gamma x^4 + O(\Gamma^{3/2})\right)
    \left(p_0 + p_1\sqrt{\frac{\Gamma}{\Real b_1}}x +\frac{p_2\Gamma}{\Real b_1}x^2 + O(\Gamma^{3/2})\right)
\end{eqw}

Таким образом, ожидаемая относительная точность вычислений $O(\Gamma^{2})$.

Дальнейшие вычисления интеграла содержатся в вольфраме. В целом, их можно охарактеризовать следующей важной формулой:
\begin{eqw}
    \int\limits_{-\infty}^{\infty}\
    e^{-x^2 - ik\sqrt{\frac{\Gamma}{\Real b_1}}x} \exp\left(-\frac{\Real b_2 \times\sqrt{\Gamma} x^3}{6\left(\Real b_1\right)^{3/2}} - \frac{\Real b_3\times \Gamma x^4}{24\left(\Real b_1\right)^{2}} \right)
    \left(p_0 + p_1\sqrt{\frac{\Gamma}{\Real b_1}}x +\frac{p_2\Gamma}{\Real b_1}x^2\right) dx = \\
    = \left(A^0 + A^1 2i\Gamma k + O(\Gamma^2)\right) e^{-\varkappa \abs{\alpha}^2 \left(2k{\Gamma}\right)^2}
\end{eqw}
Коэффициенты $A^0$ и $A^1$ можно найти в вольфрам документе. В формуле выше было использовано:
\begin{eqw}
    4\varkappa \abs{\alpha}^2\Gamma^2 = \frac{\abs{\Gamma (1+R^2)}}{4R}
\end{eqw}
Такое обозначение выполнено не случайно:
\begin{eqw}
     W(\beta) = \frac{2}{\pi}e^{-2\left(\abs{\beta} - \abs{\alpha}\right)^2}
     \sum\limits_k \frac{e^{ik\left(\Phi_0-\Phi_{\max}\right)}}{2\pi}
     \exp\left(\abs{\alpha}^2 (1-e^{2ik\Gamma}-\varkappa \left(2k{\Gamma}\right)^2)\right) \left(A^0 + A^1 2i\Gamma k + O(\Gamma^2)\right)
\end{eqw}
\subsection*{Новый путь (в разработке)}
\begin{eqw}
     &\abs{F\left(\abs{A}e^{i\phi}, e^{i\Gamma}\right)}^2 =\\
     =&\sum_{m, n = 0}^{\infty} \frac{\abs{A}^{n+m}e^{i\phi(n-m)}}{m!n!} e^{i\Gamma(n^2 - m^2)} = -\sum_{n=0}^{\infty} \frac{\abs{A}^{2n}}{n!^2} + \left(\sum_{m, n = 0, n\ge m}^{\infty}\frac{\abs{A}^{n+m}e^{i\phi(n-m)}}{m!n!} e^{i\Gamma(n^2 - m^2)} + c.c.\right)
\end{eqw}
Сделаем далее замену $n-m=k$. В таких обозначениях $n+m = 2m+k$.

\begin{eqw}
    &\sum_{m, n = 0, n>m}^{\infty}\frac{\abs{A}^{n+m}e^{i\phi(n-m)}}{m!n!}e^{i\Gamma(n^2 - m^2)} = \sum_{k=0}^{\infty}\sum_{m=0}^{\infty}\frac{\abs{A}^{2m+k}e^{i\phi k}}{m!(m+k)!}e^{i\Gamma k(2m+k)} = \\
    &=\sum_{k=0}^{\infty}\left(\abs{A} e^{i\phi}\right)^{k}e^{i\Gamma k^2}\sum_{m=0}^{\infty}\frac{\left(\abs{A}e^{i\Gamma k}\right)^{2m}}{m!(m+k)!} = \sum_{k=0}^{\infty}e^{ik(\phi - 2\Gamma)+i\Gamma k^2}I_{k}\left(\abs{A}e^{i\Gamma k}\right)=\\
    &=\frac{1}{\pi}\sum_{k=0}^{\infty}e^{ik(\phi - 2\Gamma)+i\Gamma k^2}\int\limits_0^{\pi}\cos\left(k x\right)\exp\left(\abs{A}e^{i\Gamma k}\cos(x)\right)dx
\end{eqw}
Суммирование во второй строчке произведено при помощи модифицированной функции Бесселя $I_k$.

Подставим данное соотношение в формулу для функции Вигнера. Это формула 13 в этом документе с точностью до следующих переобозначений:
\begin{eqw}
     &\abs{A}e^{i\Phi_0} = 2\alpha\beta^*e^{-i\Gamma}\\
     &A_k = e^{-2ik\Gamma+i\Gamma k^2}I_{k}\left(\abs{A}e^{i\Gamma k}\right)\\
     &A_{-k} = A_k^*
\end{eqw}
\end{document}